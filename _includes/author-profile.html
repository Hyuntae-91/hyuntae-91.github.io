{%- unless author -%}
  {%- if include.author -%}
    {%- assign author = include.author -%}
  {%- elsif page.author -%}
    {%- assign author = site.data.authors[page.author] | default: site.author -%}
  {%- else -%}
    {%- assign author = site.author -%}
  {%- endif -%}
{%- endunless -%}

<div class="author__avatar">
  {%- if author.avatar -%}
  <img src="{{ author.avatar | relative_url }}" alt="{{ author.name }}">
  {%- endif -%}
</div>

<div class="author__content">
  <h3 class="author__name">{{ author.name }}</h3>
  <p class="author__bio">{{ author.bio }}</p>

  {%- if author.links -%}
  <div class="author__urls-wrapper">
    <button class="btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      {%- for link in author.links -%}
      <li>
        <a href="{{ link.url }}"><i class="{{ link.icon }}"></i>
          <span class="label">{{ link.label }}</span></a>
      </li>
      {%- endfor -%}
    </ul>
  </div>
  {%- endif -%}

  {%- assign allowed = site.visible_categories | default: nil -%}
  {%- if allowed and allowed != empty -%}
    {%- comment -%} Determine current language and posts filtered by language {%- endcomment -%}
    {%- assign current_lang = page.lang | default: nil -%}
    {%- if current_lang == nil or current_lang == '' -%}
      {%- if page.url and page.url contains '/en/' -%}
        {%- assign current_lang = 'en' -%}
      {%- else -%}
        {%- assign current_lang = site.default_lang -%}
      {%- endif -%}
    {%- endif -%}
    {%- assign posts_by_lang = site.posts -%}
    {%- if current_lang -%}
      {%- assign posts_by_lang = posts_by_lang | where: 'lang', current_lang -%}
    {%- endif -%}
    <hr class="separator">
    <h3 class="text-small" style="margin-top:0.5rem;">Categories</h3>
    <ul class="taxonomy__index">
      {%- for name in allowed -%}
        {%- assign name_lc = name | downcase -%}
        {%- if name_lc == 'all' -%}
          {%- assign all_count = posts_by_lang | size -%}
          <li>
            <a href="{{ '/posts/' | relative_url }}">
              {{ name }} <span class="taxonomy__count">{{ all_count }}</span>
            </a>
          </li>
        {%- else -%}
          {%- assign slug = name | slugify -%}
          {%- assign name_lc = name | downcase -%}
          {%- assign cat_count = 0 -%}
          {%- for p in posts_by_lang -%}
            {%- if p.categories and p.categories != empty -%}
              {%- assign cats_lower = p.categories | join: '|' | downcase | split: '|' -%}
              {%- if cats_lower contains name_lc -%}
                {%- assign cat_count = cat_count | plus: 1 -%}
              {%- endif -%}
            {%- endif -%}
          {%- endfor -%}
          <li>
            <a href="{{ '/categories/' | relative_url }}#{{ slug }}">
              {{ name }} <span class="taxonomy__count">{{ cat_count }}</span>
            </a>
          </li>
        {%- endif -%}
      {%- endfor -%}
    </ul>
  {%- endif -%}
</div>